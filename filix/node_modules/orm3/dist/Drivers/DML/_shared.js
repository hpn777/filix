"use strict";
/**
 * Shared DML functions
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateQuery = generateQuery;
exports.execQuery = execQuery;
exports.eagerQuery = eagerQuery;
function generateQuery(sql, params) {
    return this.query.escape(sql, params);
}
function execQuery(...args) {
    let cb;
    let query;
    if (args.length === 1) {
        query = args[0];
    }
    else if (args.length === 2) {
        if (typeof args[1] === 'function') {
            query = args[0];
            cb = args[1];
        }
        else {
            query = this.generateQuery(args[0], args[1]);
        }
    }
    else if (args.length === 3) {
        query = this.generateQuery(args[0], args[1]);
        cb = args[2];
    }
    else {
        throw new Error('Invalid number of arguments');
    }
    return this.execSimpleQuery(query, cb);
}
function eagerQuery(association, opts, keys, cb) {
    const desiredKey = Object.keys(association.field);
    const assocKey = Object.keys(association.mergeAssocId);
    const where = {};
    where[desiredKey[0]] = keys;
    const query = this.query.select()
        .from(association.model.table)
        .select(opts.only)
        .from(association.mergeTable, assocKey, opts.keys)
        .select(desiredKey).as("$p")
        .where(association.mergeTable, where)
        .build();
    if (typeof cb === 'function') {
        this.execSimpleQuery(query, cb);
        return;
    }
    return this.execSimpleQuery(query);
}
exports.default = {
    generateQuery,
    execQuery,
    eagerQuery
};
//# sourceMappingURL=_shared.js.map